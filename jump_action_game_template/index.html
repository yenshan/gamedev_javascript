<html>
    <head>
        <link rel="stylesheet" href="./assets/style.css" type="text/css">
    </head>
    <body>
        <div id="gameContainer">
                <div id="dpad">
                    <div class="dpad-button" id="dpad-up" value="up">
                        <svg width="50" height="50" xmlns="http://www.w3.org/2000/svg">
                            <polygon points="25,5 45,45 5,45" fill="gray" /></svg>
                    </div>
                    <div class="dpad-button" id="dpad-left" value="left">
                        <svg width="50" height="50" xmlns="http://www.w3.org/2000/svg">
                            <polygon points="5,25 45,5 45,45" fill="gray" /></svg>
                    </div>
                    <div class="dpad-button" id="dpad-right" value="right">
                        <svg width="50" height="50" xmlns="http://www.w3.org/2000/svg">
                            <polygon points="45,25 5,5 5,45" fill="gray" /></svg>
                    </div>
                    <div class="dpad-button" id="dpad-down" value="down">
                        <svg width="50" height="50" xmlns="http://www.w3.org/2000/svg">
                            <polygon points="25,45 5,5 45,5" fill="gray" /></svg>
                    </div>
                </div>
            <div id="canvasContainer">
                <canvas id="gameCanvas" style="border:1px solid #000000; background-color: #000000;"></canvas>
            </div>
                <div id="buttons">
                    <div class="button" id="buttonA" value="A">A</div>
            </div>
        </div>

        <canvas id="canvasBg" style="border:1px solid #000000; background-color: #000000; display:none;"></canvas>

        <script type="module" src="index.js"></script>

        <script>
            // Disable touch events outside buttons
            document.body.addEventListener('touchstart', function(event) {
                if (!event.target.closest('.dpad-button') && !event.target.closest('.button')) {
                    event.preventDefault();
                }
            }, { passive: false });

            // Make controls draggable
            let isDragging = false;
            let offsetX, offsetY;

            controlsContainer.addEventListener('touchstart', (e) => {
                isDragging = true;
                const touch = e.touches[0];
                offsetX = touch.clientX - controlsContainer.getBoundingClientRect().left;
                offsetY = touch.clientY - controlsContainer.getBoundingClientRect().top;
                controlsContainer.style.cursor = 'grabbing';
            });

            window.addEventListener('touchmove', (e) => {
                if (isDragging) {
                    const touch = e.touches[0];
                    controlsContainer.style.left = `${touch.clientX - offsetX}px`;
                    controlsContainer.style.top = `${touch.clientY - offsetY}px`;
                }
            });

            window.addEventListener('touchend', () => {
                if (isDragging) {
                    isDragging = false;
                    controlsContainer.style.cursor = 'grab';
                }
            });

            controlsContainer.addEventListener('mousedown', (e) => {
                isDragging = true;
                offsetX = e.clientX - controlsContainer.getBoundingClientRect().left;
                offsetY = e.clientY - controlsContainer.getBoundingClientRect().top;
                controlsContainer.style.cursor = 'grabbing';
            });

            window.addEventListener('mousemove', (e) => {
                if (isDragging) {
                    controlsContainer.style.left = `${e.clientX - offsetX}px`;
                    controlsContainer.style.top = `${e.clientY - offsetY}px`;
                }
            });

            window.addEventListener('mouseup', () => {
                if (isDragging) {
                    isDragging = false;
                    controlsContainer.style.cursor = 'grab';
                }
            });

        </script>
    </body>
</html>
